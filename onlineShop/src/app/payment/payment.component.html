<div class="payment-container">
  <h2>Fizet√©s</h2>
  
  <form (ngSubmit)="onSubmit()" #paymentForm="ngForm">
    <!-- Szem√©lyes adatok -->
    <div class="form-group">
      <label for="fullName">Teljes n√©v</label>
      <input type="text" id="fullName" name="fullName" [(ngModel)]="paymentData.fullName" required>
    </div>

    <div class="form-group">
      <label for="email">Email c√≠m</label>
      <input type="email" id="email" name="email" [(ngModel)]="paymentData.email" required>
    </div>

    <!-- K√°rtya adatok -->
    <div class="form-group">
      <label>Bankk√°rtya adatok</label>
      <div id="card-container"></div>
    </div>

    <div class="form-group">
      <label for="cardholderName">K√°rty√°n szerepl≈ë n√©v</label>
      <input type="text" id="cardholderName" name="cardholderName" [(ngModel)]="paymentData.cardholderName" required>
    </div>

    <!-- √Åltal√°nos szerz≈ëd√©si felt√©telek -->
    <div class="form-group terms">
      <input type="checkbox" id="terms" name="terms" [(ngModel)]="paymentData.termsAccepted" required>
      <label for="terms">Elfogadom a <a href="#">√Åltal√°nos Szerz≈ëd√©si Felt√©teleket</a></label>
    </div>

    <!-- Fizet√©s gomb -->
    <button type="submit" [disabled]="!paymentForm.valid || processing">
      {{ processing ? 'Feldolgoz√°s...' : 'Fizet√©s' }}
    </button>

    <!-- St√°tusz √ºzenet -->
    <div *ngIf="statusMessage" class="status-message" [class.success]="paymentSuccess" [class.error]="!paymentSuccess">
      {{ statusMessage }}
    </div>
  </form>

  <!-- API Interaction Details - Always visible -->
  <div class="api-details-container" *ngIf="apiInteraction.sent">
    <h3 class="api-title">Square API Kommunik√°ci√≥</h3>
    
    <div class="api-instruction-box">
      <h4>Square Developer Dashboard API Logs</h4>
      <p>Ez a panel a Square Sandbox API-hoz k√ºld√∂tt k√©r√©seket √©s v√°laszokat jelen√≠ti meg. 
         A val√≥s API k√©r√©sek √©s v√°laszok a Square fejleszt≈ëi fel√ºlet√©n az 
         <strong>API Logs</strong> szekci√≥ban jelennek meg.</p>
      <p>A fizet√©s feldolgoz√°sa sor√°n, az al√°bbi API h√≠v√°s fog megt√∂rt√©nni a
         <span class="code-highlight">https://connect.squareupsandbox.com/v2/payments</span> v√©gpontra.</p>
    </div>
    
    <div class="api-details">
      <div class="api-section">
        <h3>üîÑ Square API K√©r√©s</h3>
        <div class="api-endpoint">
          <strong>V√©gpont:</strong> {{ apiInteraction.request?.endpoint }}
        </div>
        <div class="api-method">
          <strong>Met√≥dus:</strong> {{ apiInteraction.request?.method }}
        </div>
        <div class="api-time" *ngIf="apiInteraction.request?.timestamp">
          <strong>Id≈ëb√©lyeg:</strong> {{ apiInteraction.request?.timestamp | date:'yyyy-MM-dd HH:mm:ss' }}
        </div>
        
        <div class="api-headers">
          <h4>HTTP Headers</h4>
          <div class="api-header-list">
            <div class="api-header-item">
              <p><strong>Square-Version:</strong> 2023-06-08</p>
              <p><strong>Content-Type:</strong> application/json</p>
              <p><strong>Authorization:</strong> Bearer [MASKED FOR SECURITY]</p>
            </div>
          </div>
        </div>
        
        <div class="api-body">
          <h4>Request Body</h4>
          <pre class="api-json">{{ apiInteraction.request?.body | json }}</pre>
        </div>
      </div>
      
      <div class="api-section" *ngIf="apiInteraction.response">
        <h3>{{ apiInteraction.response?.status < 400 ? '‚úÖ' : '‚ùå' }} Square API V√°lasz</h3>
        <div class="api-status" [ngClass]="{'success': apiInteraction.response?.status < 400, 'error': apiInteraction.response?.status >= 400}">
          <strong>√Ållapot:</strong> {{ apiInteraction.response?.status }} {{ apiInteraction.response?.statusText }}
        </div>
        <div class="api-time" *ngIf="apiInteraction.response?.timestamp">
          <strong>Id≈ëb√©lyeg:</strong> {{ apiInteraction.response?.timestamp | date:'yyyy-MM-dd HH:mm:ss' }}
        </div>
        
        <div class="api-body">
          <h4>Response Body</h4>
          <pre class="api-json">{{ apiInteraction.response?.body | json }}</pre>
        </div>
      </div>
      
      <div class="api-note">
        <h4>CORS Korl√°toz√°s - Fontos inform√°ci√≥:</h4>
        <ul>
          <li>Biztons√°gi okokb√≥l <strong>CORS korl√°toz√°s</strong> miatt b√∂ng√©sz≈ëb≈ël <strong>nem lehet</strong> k√∂zvetlen√ºl API h√≠v√°st k√ºldeni a Square-nek</li>
          <li>A fenti API h√≠v√°s <strong>csak szimul√°lt</strong>, ez√©rt nem jelenik meg a Square Developer Dashboard API Logs szekci√≥ban</li>
          <li>Val√≥s implement√°ci√≥n√°l az API h√≠v√°sokat szerver oldalon kell kezelni, vagy a Square Payment Form SDK-t haszn√°lni</li>
        </ul>
        
        <div class="cors-solution">
          <h5>Megold√°si javaslatok:</h5>
          <ol>
            <li>Hozz l√©tre egy <strong>backend szolg√°ltat√°st</strong> (pl. Node.js, PHP, stb.) ami tov√°bb√≠tja a k√©r√©seket a Square API-nak</li>
            <li>A szerver fogadja a fizet√©si adatokat a frontenddel, √©s ≈ë k√ºldi el a Square-nek</li>
            <li>A szerver fogadja a v√°laszt a Square-t≈ël, √©s tov√°bb√≠tja a frontend fel√©</li>
            <li>√çgy a Square API h√≠v√°sok megjelennek a Developer Dashboard API Logs szekci√≥ban</li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</div>
